"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assert = require("assert");
const src_1 = require("../src");
const fixtures_1 = require("./fixtures");
const CachingHttpClient_1 = require("./CachingHttpClient");
function getTestAddress(coinName) {
    switch (coinName) {
        case 'tbtc':
            return '2NEhVzd2Lom5g7ZF5K1qYrgZLpXecniqHcE';
    }
    throw new Error(`unsupported coin ${coinName}`);
}
function getTestTransactionId(coinName) {
    switch (coinName) {
        case 'tbtc':
            return '19c6cd6b7b8a91e1a63d759eedd2818877a624771d38e00c3ffcedfdd09afc50';
    }
    throw new Error(`unsupported coin ${coinName}`);
}
const methods = ['getUnspentsForAddresses', 'getTransactionInputs', 'getTransactionHex'];
async function getFixtureUtxoApi(coinName, api, methodName, v) {
    return await (0, fixtures_1.getFixture)(`${__dirname}/fixtures/UtxoApi.${api.constructor.name}.${coinName}.${methodName}.json`, v);
}
function getHttpClient(name) {
    return new CachingHttpClient_1.CachingHttpClient(`${__dirname}/fixtures/responses/` + name);
}
function getApis(coinName) {
    if (coinName === 'tbtc') {
        return [
            // BitGoApi.forCoin(coinName),
            src_1.BlockchairApi.forCoin(coinName, { httpClient: getHttpClient('blockchair') }),
            src_1.BlockstreamApi.forCoin(coinName, { httpClient: getHttpClient('blockstream') }),
        ];
    }
    return [];
}
function runTestFetch(api, coinName) {
    describe(`UtxoApi coinName=${coinName} api=${api.constructor.name}`, function () {
        it('fetches unspents by address', async function () {
            this.timeout(10000);
            const unspents = await api.getUnspentsForAddresses([getTestAddress(coinName)]);
            assert.deepStrictEqual(unspents, await getFixtureUtxoApi(coinName, api, 'getUnspentsForAddresses', unspents));
        });
        it('fetches transaction hex', async function () {
            this.timeout(10000);
            const txHex = await api.getTransactionHex(getTestTransactionId(coinName));
            assert.deepStrictEqual(txHex, await getFixtureUtxoApi(coinName, api, 'getTransactionHex', txHex));
        });
        it('fetches unspents for transaction', async function () {
            this.timeout(10000);
            const unspents = await api.getTransactionInputs(getTestTransactionId(coinName));
            assert.deepStrictEqual(unspents, await getFixtureUtxoApi(coinName, api, 'getTransactionInputs', unspents));
        });
    });
}
function runTestCompare(api, coinName) {
    describe(`UtxoApi coinName=${coinName} api=${api.constructor.name}`, function () {
        getApis(coinName)
            .filter((otherApi) => api.constructor !== otherApi.constructor)
            .forEach((otherApi) => {
            methods.forEach((methodName) => {
                it(`compare ${methodName} results with ${otherApi.constructor.name}`, async function () {
                    const unspents = await getFixtureUtxoApi(coinName, api, methodName);
                    const otherUnspents = await getFixtureUtxoApi(coinName, otherApi, methodName);
                    assert.deepStrictEqual(unspents, otherUnspents);
                });
            });
        });
    });
}
['tbtc'].forEach((coinName) => {
    getApis(coinName).forEach((api) => {
        runTestFetch(api, coinName);
    });
    getApis(coinName).forEach((api) => {
        runTestCompare(api, coinName);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXR4b0FwaS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3Rlc3QvVXR4b0FwaS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGlDQUFpQztBQUNqQyxnQ0FBZ0U7QUFDaEUseUNBQXdDO0FBQ3hDLDJEQUF3RDtBQUV4RCxTQUFTLGNBQWMsQ0FBQyxRQUFnQjtJQUN0QyxRQUFRLFFBQVEsRUFBRTtRQUNoQixLQUFLLE1BQU07WUFDVCxPQUFPLHFDQUFxQyxDQUFDO0tBQ2hEO0lBQ0QsTUFBTSxJQUFJLEtBQUssQ0FBQyxvQkFBb0IsUUFBUSxFQUFFLENBQUMsQ0FBQztBQUNsRCxDQUFDO0FBRUQsU0FBUyxvQkFBb0IsQ0FBQyxRQUFnQjtJQUM1QyxRQUFRLFFBQVEsRUFBRTtRQUNoQixLQUFLLE1BQU07WUFDVCxPQUFPLGtFQUFrRSxDQUFDO0tBQzdFO0lBQ0QsTUFBTSxJQUFJLEtBQUssQ0FBQyxvQkFBb0IsUUFBUSxFQUFFLENBQUMsQ0FBQztBQUNsRCxDQUFDO0FBRUQsTUFBTSxPQUFPLEdBQUcsQ0FBQyx5QkFBeUIsRUFBRSxzQkFBc0IsRUFBRSxtQkFBbUIsQ0FBVSxDQUFDO0FBSWxHLEtBQUssVUFBVSxpQkFBaUIsQ0FBSSxRQUFnQixFQUFFLEdBQVksRUFBRSxVQUFxQixFQUFFLENBQUs7SUFDOUYsT0FBTyxNQUFNLElBQUEscUJBQVUsRUFBQyxHQUFHLFNBQVMscUJBQXFCLEdBQUcsQ0FBQyxXQUFXLENBQUMsSUFBSSxJQUFJLFFBQVEsSUFBSSxVQUFVLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQztBQUNySCxDQUFDO0FBRUQsU0FBUyxhQUFhLENBQUMsSUFBWTtJQUNqQyxPQUFPLElBQUkscUNBQWlCLENBQUMsR0FBRyxTQUFTLHNCQUFzQixHQUFHLElBQUksQ0FBQyxDQUFDO0FBQzFFLENBQUM7QUFFRCxTQUFTLE9BQU8sQ0FBQyxRQUFnQjtJQUMvQixJQUFJLFFBQVEsS0FBSyxNQUFNLEVBQUU7UUFDdkIsT0FB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QyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQztBQUVELENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsUUFBUSxFQUFFLEVBQUU7SUFDNUIsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFO1FBQ2hDLFlBQVksQ0FBQyxHQUFHLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDOUIsQ0FBQyxDQUFDLENBQUM7SUFDSCxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUU7UUFDaEMsY0FBYyxDQUFDLEdBQUcsRUFBRSxRQUFRLENBQUMsQ0FBQztJQUNoQyxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgYXNzZXJ0IGZyb20gJ2Fzc2VydCc7XG5pbXBvcnQgeyBCbG9ja2NoYWlyQXBpLCBCbG9ja3N0cmVhbUFwaSwgVXR4b0FwaSB9IGZyb20gJy4uL3NyYyc7XG5pbXBvcnQgeyBnZXRGaXh0dXJlIH0gZnJvbSAnLi9maXh0dXJlcyc7XG5pbXBvcnQgeyBDYWNoaW5nSHR0cENsaWVudCB9IGZyb20gJy4vQ2FjaGluZ0h0dHBDbGllbnQnO1xuXG5mdW5jdGlvbiBnZXRUZXN0QWRkcmVzcyhjb2luTmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgc3dpdGNoIChjb2luTmFtZSkge1xuICAgIGNhc2UgJ3RidGMnOlxuICAgICAgcmV0dXJuICcyTkVoVnpkMkxvbTVnN1pGNUsxcVlyZ1pMcFhlY25pcUhjRSc7XG4gIH1cbiAgdGhyb3cgbmV3IEVycm9yKGB1bnN1cHBvcnRlZCBjb2luICR7Y29pbk5hbWV9YCk7XG59XG5cbmZ1bmN0aW9uIGdldFRlc3RUcmFuc2FjdGlvbklkKGNvaW5OYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xuICBzd2l0Y2ggKGNvaW5OYW1lKSB7XG4gICAgY2FzZSAndGJ0Yyc6XG4gICAgICByZXR1cm4gJzE5YzZjZDZiN2I4YTkxZTFhNjNkNzU5ZWVkZDI4MTg4NzdhNjI0NzcxZDM4ZTAwYzNmZmNlZGZkZDA5YWZjNTAnO1xuICB9XG4gIHRocm93IG5ldyBFcnJvcihgdW5zdXBwb3J0ZWQgY29pbiAke2NvaW5OYW1lfWApO1xufVxuXG5jb25zdCBtZXRob2RzID0gWydnZXRVbnNwZW50c0ZvckFkZHJlc3NlcycsICdnZXRUcmFuc2FjdGlvbklucHV0cycsICdnZXRUcmFuc2FjdGlvbkhleCddIGFzIGNvbnN0O1xuXG50eXBlIEFwaU1ldGhvZCA9IHR5cGVvZiBtZXRob2RzW251bWJlcl07XG5cbmFzeW5jIGZ1bmN0aW9uIGdldEZpeHR1cmVVdHhvQXBpPFQ+KGNvaW5OYW1lOiBzdHJpbmcsIGFwaTogVXR4b0FwaSwgbWV0aG9kTmFtZTogQXBpTWV0aG9kLCB2PzogVCk6IFByb21pc2U8VD4ge1xuICByZXR1cm4gYXdhaXQgZ2V0Rml4dHVyZShgJHtfX2Rpcm5hbWV9L2ZpeHR1cmVzL1V0eG9BcGkuJHthcGkuY29uc3RydWN0b3IubmFtZX0uJHtjb2luTmFtZX0uJHttZXRob2ROYW1lfS5qc29uYCwgdik7XG59XG5cbmZ1bmN0aW9uIGdldEh0dHBDbGllbnQobmFtZTogc3RyaW5nKTogQ2FjaGluZ0h0dHBDbGllbnQge1xuICByZXR1cm4gbmV3IENhY2hpbmdIdHRwQ2xpZW50KGAke19fZGlybmFtZX0vZml4dHVyZXMvcmVzcG9uc2VzL2AgKyBuYW1lKTtcbn1cblxuZnVuY3Rpb24gZ2V0QXBpcyhjb2luTmFtZTogc3RyaW5nKTogVXR4b0FwaVtdIHtcbiAgaWYgKGNvaW5OYW1lID09PSAndGJ0YycpIHtcbiAgICByZXR1cm4gW1xuICAgICAgLy8gQml0R29BcGkuZm9yQ29pbihjb2luTmFtZSksXG4gICAgICBCbG9ja2NoYWlyQXBpLmZvckNvaW4oY29pbk5hbWUsIHsgaHR0cENsaWVudDogZ2V0SHR0cENsaWVudCgnYmxvY2tjaGFpcicpIH0pLFxuICAgICAgQmxvY2tzdHJlYW1BcGkuZm9yQ29pbihjb2luTmFtZSwgeyBodHRwQ2xpZW50OiBnZXRIdHRwQ2xpZW50KCdibG9ja3N0cmVhbScpIH0pLFxuICAgIF07XG4gIH1cbiAgcmV0dXJuIFtdO1xufVxuXG5mdW5jdGlvbiBydW5UZXN0RmV0Y2goYXBpOiBVdHhvQXBpLCBjb2luTmFtZTogc3RyaW5nKSB7XG4gIGRlc2NyaWJlKGBVdHhvQXBpIGNvaW5OYW1lPSR7Y29pbk5hbWV9IGFwaT0ke2FwaS5jb25zdHJ1Y3Rvci5uYW1lfWAsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnZmV0Y2hlcyB1bnNwZW50cyBieSBhZGRyZXNzJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy50aW1lb3V0KDEwXzAwMCk7XG4gICAgICBjb25zdCB1bnNwZW50cyA9IGF3YWl0IGFwaS5nZXRVbnNwZW50c0ZvckFkZHJlc3NlcyhbZ2V0VGVzdEFkZHJlc3MoY29pbk5hbWUpXSk7XG4gICAgICBhc3NlcnQuZGVlcFN0cmljdEVxdWFsKHVuc3BlbnRzLCBhd2FpdCBnZXRGaXh0dXJlVXR4b0FwaShjb2luTmFtZSwgYXBpLCAnZ2V0VW5zcGVudHNGb3JBZGRyZXNzZXMnLCB1bnNwZW50cykpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2ZldGNoZXMgdHJhbnNhY3Rpb24gaGV4JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy50aW1lb3V0KDEwXzAwMCk7XG4gICAgICBjb25zdCB0eEhleCA9IGF3YWl0IGFwaS5nZXRUcmFuc2FjdGlvbkhleChnZXRUZXN0VHJhbnNhY3Rpb25JZChjb2luTmFtZSkpO1xuICAgICAgYXNzZXJ0LmRlZXBTdHJpY3RFcXVhbCh0eEhleCwgYXdhaXQgZ2V0Rml4dHVyZVV0eG9BcGkoY29pbk5hbWUsIGFwaSwgJ2dldFRyYW5zYWN0aW9uSGV4JywgdHhIZXgpKTtcbiAgICB9KTtcblxuICAgIGl0KCdmZXRjaGVzIHVuc3BlbnRzIGZvciB0cmFuc2FjdGlvbicsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMudGltZW91dCgxMF8wMDApO1xuICAgICAgY29uc3QgdW5zcGVudHMgPSBhd2FpdCBhcGkuZ2V0VHJhbnNhY3Rpb25JbnB1dHMoZ2V0VGVzdFRyYW5zYWN0aW9uSWQoY29pbk5hbWUpKTtcbiAgICAgIGFzc2VydC5kZWVwU3RyaWN0RXF1YWwodW5zcGVudHMsIGF3YWl0IGdldEZpeHR1cmVVdHhvQXBpKGNvaW5OYW1lLCBhcGksICdnZXRUcmFuc2FjdGlvbklucHV0cycsIHVuc3BlbnRzKSk7XG4gICAgfSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBydW5UZXN0Q29tcGFyZShhcGk6IFV0eG9BcGksIGNvaW5OYW1lOiBzdHJpbmcpIHtcbiAgZGVzY3JpYmUoYFV0eG9BcGkgY29pbk5hbWU9JHtjb2luTmFtZX0gYXBpPSR7YXBpLmNvbnN0cnVjdG9yLm5hbWV9YCwgZnVuY3Rpb24gKCkge1xuICAgIGdldEFwaXMoY29pbk5hbWUpXG4gICAgICAuZmlsdGVyKChvdGhlckFwaSkgPT4gYXBpLmNvbnN0cnVjdG9yICE9PSBvdGhlckFwaS5jb25zdHJ1Y3RvcilcbiAgICAgIC5mb3JFYWNoKChvdGhlckFwaSkgPT4ge1xuICAgICAgICBtZXRob2RzLmZvckVhY2goKG1ldGhvZE5hbWUpID0+IHtcbiAgICAgICAgICBpdChgY29tcGFyZSAke21ldGhvZE5hbWV9IHJlc3VsdHMgd2l0aCAke290aGVyQXBpLmNvbnN0cnVjdG9yLm5hbWV9YCwgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc3QgdW5zcGVudHMgPSBhd2FpdCBnZXRGaXh0dXJlVXR4b0FwaShjb2luTmFtZSwgYXBpLCBtZXRob2ROYW1lKTtcbiAgICAgICAgICAgIGNvbnN0IG90aGVyVW5zcGVudHMgPSBhd2FpdCBnZXRGaXh0dXJlVXR4b0FwaShjb2luTmFtZSwgb3RoZXJBcGksIG1ldGhvZE5hbWUpO1xuICAgICAgICAgICAgYXNzZXJ0LmRlZXBTdHJpY3RFcXVhbCh1bnNwZW50cywgb3RoZXJVbnNwZW50cyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gIH0pO1xufVxuXG5bJ3RidGMnXS5mb3JFYWNoKChjb2luTmFtZSkgPT4ge1xuICBnZXRBcGlzKGNvaW5OYW1lKS5mb3JFYWNoKChhcGkpID0+IHtcbiAgICBydW5UZXN0RmV0Y2goYXBpLCBjb2luTmFtZSk7XG4gIH0pO1xuICBnZXRBcGlzKGNvaW5OYW1lKS5mb3JFYWNoKChhcGkpID0+IHtcbiAgICBydW5UZXN0Q29tcGFyZShhcGksIGNvaW5OYW1lKTtcbiAgfSk7XG59KTtcbiJdfQ==